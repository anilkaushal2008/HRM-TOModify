@using System.Data
@using System.Collections
@using System.Web
@{
    // 1. LINK TO THE MASTER LAYOUT
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "My Profile";
}

@if (Session["UserId"] != null)
{
    <style>
        /* --- PROFILE-SPECIFIC UI HIERARCHY --- */
        .modern-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 24px;
            box-shadow: 0 4px 20px -4px rgba(0, 0, 0, 0.05);
            padding: 30px;
            margin-bottom: 25px;
        }

            /* Data Titles: Bold and standard size */
            .profile-details-section label,
            .profile-details-section dt,
            .modern-card dt,
            .modern-card label,
            .modern-card th {
                font-size: 0.88rem !important;
                font-weight: 700 !important;
                color: var(--text-main) !important;
                margin-bottom: 4px;
                display: block;
            }

            /* Information: Slightly smaller with muted contrast */
            .profile-details-section span,
            .profile-details-section dd,
            .modern-card dd,
            .modern-card span,
            .modern-card p {
                font-size: 0.82rem !important;
                font-weight: 500 !important;
                color: var(--text-muted) !important;
                margin-bottom: 15px;
                display: block;
                line-height: 1.4;
            }

            /* Table Alignment & Visibility */
            .modern-card table {
                width: 100% !important;
                border-collapse: collapse !important;
                margin-bottom: 1.5rem;
            }

                .modern-card table th {
                    font-size: 0.88rem !important;
                    font-weight: 700 !important;
                    color: var(--text-main) !important;
                    padding: 12px 10px !important;
                    border-bottom: 2px solid var(--border) !important;
                    text-align: left;
                    background-color: transparent !important;
                }

                .modern-card table td {
                    font-size: 0.82rem !important;
                    font-weight: 500 !important;
                    color: var(--text-muted) !important;
                    padding: 12px 10px !important;
                    border-bottom: 1px solid var(--border) !important;
                    vertical-align: middle !important;
                }

                    /* Table Action Column */
                    .modern-card table th:last-child,
                    .modern-card table td:last-child {
                        text-align: center !important;
                        width: 140px;
                    }

        /* Dark Mode Visibility Force */
        [data-theme="dark"] .modern-card table td,
        [data-theme="dark"] .modern-card table td *,
        [data-theme="dark"] .modern-card table th,
        [data-theme="dark"] .modern-card span,
        [data-theme="dark"] .modern-card dd,
        [data-theme="dark"] .modern-card p {
            color: var(--text-main) !important;
        }

        h4 {
            font-size: 0.95rem;
            font-weight: 800;
            color: var(--accent);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

            h4::before {
                content: '';
                display: block;
                width: 4px;
                height: 18px;
                background: var(--accent);
                border-radius: 10px;
            }

        .profile-picture-section img {
            border: 4px solid var(--bg-body);
            outline: 1px solid var(--border);
            border-radius: 28px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            object-fit: cover;
            background: var(--bg-card);
        }

        .border-right {
            border-right: 1px solid var(--border) !important;
        }

        @@media (max-width: 992px) {
            .border-right {
                border-right: none !important;
                border-bottom: 1px solid var(--border);
                padding-bottom: 25px;
                margin-bottom: 25px;
            }
        }
    </style>

    <div class="mb-5 px-1">
        <h3 class="font-weight-bold">My Identity</h3>
        <p class="text-muted small">Comprehensive view of your employment records and verified credentials.</p>
    </div>

    using (Html.BeginForm())
    {
        <div class="modern-card">
            @if (TempData["Error"] == null)
            {
                <div class="row">
                    <div class="col-lg-8 border-right">
                        <div class="profile-details-section">
                            <h4 class="mb-4">Personal Overview</h4>
                            @{ Html.RenderAction("MasDetail", "NewEmployeeLogin"); }
                        </div>
                    </div>
                    <div class="col-lg-4 text-center py-4">
                        <div class="profile-picture-section">
                            @{ Html.RenderAction("PictureDetail", "NewEmployeeLogin"); }
                        </div>
                        <div class="mt-4">
                            <span class="badge badge-light border px-4 py-2 rounded-pill font-weight-bold shadow-sm" style="font-size: 0.75rem;">Verified Account</span>
                        </div>
                    </div>
                </div>

                <hr />

                <div class="row">
                    <div class="col-12">
                        <div class="profile-details-section">
                            @if (Session["IsConsultant"]?.ToString() == "True")
                            {
                                <h4 class="mb-4">Consultant Credentials</h4>
                                { Html.RenderAction("ConsultantDoc", "NewEmployeeLogin"); }
                            }
                            else
                            {
                                <h4 class="mb-4">Employment Records</h4>
                                { Html.RenderAction("PartialEmpDetail", "NewEmployeeLogin"); }
                            }
                        </div>
                    </div>
                </div>

                if (Session["IsConsultant"]?.ToString() != "True")
                {
                    <hr />
                    <div class="row">
                        <div class="col-12">
                            <div class="profile-details-section">
                                <h4 class="mb-4">Company Documents</h4>
                                @{ Html.RenderAction("PCompDoc", "NewEmployeeLogin"); }
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="alert alert-danger border-0 shadow-sm rounded-xl p-4 d-flex align-items-center">
                    <i class="fas fa-exclamation-circle fa-2x mr-3"></i>
                    <div>
                        <h6 class="font-weight-bold mb-1">Record Sync Error</h6>
                        <p class="mb-0 small">@TempData["Error"]</p>
                    </div>
                </div>
            }
        </div>
    }

    <div id="resultMessage" class="mt-4 text-center font-weight-bold"></div>
}
else
{
    @Html.Action("_SessionError1", "Home")
}

@section Scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            // Qualification form logic
            $('#updateQualificationForm').hide();

            $(document).on('click', '#updateQul', function (event) {
                $('#updateQualificationForm').slideDown();
            });

            $(document).on('click', '#updateQualificationButton', function (event) {
                event.preventDefault();
                var employeeId = $('#empid').val();
                var qualification = $('#qualification').val();
                var $btn = $(this);

                // UI Loading state
                $btn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin mr-1"></i> Updating...');

                $.ajax({
                    url: '/NewEmployeeLogin/UpdateQualification',
                    type: 'POST',
                    data: { employeeId: employeeId, quali: qualification },
                    success: function (response) {
                        $('#resultMessage').text(response.message).css('color', response.success ? '#10b981' : '#ef4444');
                        if (response.success == true) {
                            setTimeout(function () { location.reload(); }, 1500);
                        }
                    },
                    error: function () {
                        $('#resultMessage').text('Server error occurred while updating.').css('color', '#ef4444');
                    },
                    complete: function () {
                        $btn.prop('disabled', false).text('Update Qualification');
                    }
                });
            });
        });
    </script>
}